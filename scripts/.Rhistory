bionanodirectory <- "/home/marta/TESIS/OGM+WES/PULPO_ejecutadoprueba/results/"
library(dplyr)
sv_df <- data.frame(
chrom1 = character(),
pos1 = numeric(),
chrom2 = character(),
pos2 = numeric(),
strand1 = character(),
strand2 = character(),
svtype = character(),
sample = character(),
stringsAsFactors = FALSE
)
########################################################
patients <- list.files(bionanodirectory)
bionanofilesdirectories <- list()
########################################################
#########FUNCTIONS######################################
process_file_sv <- function(file_path, result_dir) {
# Read the file
bionanotable <- read.table(file_path, header = FALSE)
# Extract the sample name (Patient-*)
sample_regex <- regmatches(file_path, regexpr("Patient-[^/]+", file_path))
sample <- sample_regex[[1]]
svtype <- bionanotable[10]
str(svtype)
class(svtype)
svtype <- as.character(svtype)
svtype <- unlist(svtype)
bionanotable$V10 <- as.character(bionanotable$V10)
bionanotable$V10 <- gsub("^deletion(_.*)?$", "DEL", bionanotable$V10)
bionanotable$V10 <- gsub("^translocation_.*", "TRA", bionanotable$V10)
bionanotable$V10 <- gsub("^duplication(_.*)?$", "DUP", bionanotable$V10)
bionanotable$V10 <- gsub("^duplication", "DUP", bionanotable$V10)
# Select relevant columns and rename
sv_df <- data.frame(
chrom1 = bionanotable[3],
pos1 = bionanotable[7],
chrom2 = bionanotable[4],
pos2 = bionanotable[8],
strand = bionanotable[24],
svtype = bionanotable$V10
) %>%
mutate(
strand1 = sapply(strsplit(as.character(V24), "/"), function(x) ifelse(length(x) > 1, x[1], NA)),
strand2 = sapply(strsplit(as.character(V24), "/"), function(x) ifelse(length(x) > 1, x[2], NA)),
strand1 = ifelse(is.na(strand1), "0", strand1),
strand2 = ifelse(is.na(strand2), "0", strand2)
) %>%
select(-V24) %>%
rename(
chrom1 = V3,
pos1 = V7,
chrom2 = V4,
pos2 = V8
)
sv_df <- sv_df %>%
mutate(
svtype = case_when(
svtype == "inversion" & strand1 == "+" & strand2 == "+" ~ "h2hINV",
svtype == "inversion" & strand1 == "-" & strand2 == "-" ~ "t2tINV",
TRUE ~ svtype
),
strand1 = case_when(
svtype == "DEL" ~ "+",
svtype == "DUP" ~ "-",
TRUE ~ strand1
),
strand2 = case_when(
svtype == "DEL" ~ "-",
svtype == "DUP" ~ "+",
TRUE ~ strand2
)
)
# Add sample column
sv_df$sample <- sample
sv_df <- sv_df %>% filter(svtype != "insertion")
sv_df$pos1 <- round(sv_df$pos1)
sv_df$pos2 <- round(sv_df$pos2)
sv_df <- sv_df %>% filter(svtype != "inversion")
sv_df <- sv_df %>% filter(svtype != "inversion_partial")
sv_df <- sv_df %>% select(chrom1, pos1, chrom2, pos2, strand1, strand2, svtype, sample)
# Create the sample directory and ensure Bionanodata directory exists
sample_dir <- file.path(result_dir, sample, "Bionanodata")
if (!dir.exists(sample_dir)) {
dir.create(sample_dir, recursive = TRUE)
}
# Export the data frame as CSV
output_file <- file.path(sample_dir, paste0("sv_df_", sample, ".csv"))
write.csv(sv_df, file = output_file, row.names = FALSE)
# Print confirmation message
cat("Export file:", output_file, "\n")
}
###############CREATEDFOFDIRECTORIES####################
for (i in patients) {
print(i)
wholedirectory <- file.path(bionanodirectory, i, "Bionanodata")
bionanofile <- list.files(wholedirectory)
cnvfile <- grep("*.smap", bionanofile, value = TRUE)
wholedirectory <- file.path(wholedirectory, cnvfile)
print(wholedirectory)
bionanofilesdirectories <- c(bionanofilesdirectories, wholedirectory)
}
lapply(bionanofilesdirectories, process_file_sv, bionanodirectory)
########VARIABLES########
bionanodirectory <- "/home/marta/TESIS/OGM+WES/PULPO_ejecutadoprueba/results/"
result_dir <- "/home/marta/TESIS/OGM+WES/PULPO_ejecutadoprueba/results"
########VARIABLES########
bionanodirectory <- "/home/marta/TESIS/OGM+WES/PULPO_ejecutadoprueba/results/"
result_dir <- "/home/marta/TESIS/OGM+WES/PULPO_ejecutadoprueba/results"
###LOADS########
#library(Starfish)
library(dplyr)
#######CREATIONOFTHEDF#########
sv_df <- data.frame(
chrom1 = character(),
pos1 = numeric(),
chrom2 = character(),
pos2 = numeric(),
strand1 = character(),
strand2 = character(),
svtype = character(),
sample = character(),
stringsAsFactors = FALSE
)
########################################################
patients <- list.files(bionanodirectory)
bionanofilesdirectories <- list()
########################################################
#########FUNCTIONS######################################
process_file_sv <- function(file_path, result_dir) {
# Read the file
bionanotable <- read.table(file_path, header = FALSE)
# Extract the sample name (Patient-*)
sample_regex <- regmatches(file_path, regexpr("Patient-[^/]+", file_path))
sample <- sample_regex[[1]]
svtype <- bionanotable[10]
str(svtype)
class(svtype)
svtype <- as.character(svtype)
svtype <- unlist(svtype)
bionanotable$V10 <- as.character(bionanotable$V10)
bionanotable$V10 <- gsub("^deletion(_.*)?$", "DEL", bionanotable$V10)
bionanotable$V10 <- gsub("^translocation_.*", "TRA", bionanotable$V10)
bionanotable$V10 <- gsub("^duplication(_.*)?$", "DUP", bionanotable$V10)
bionanotable$V10 <- gsub("^duplication", "DUP", bionanotable$V10)
# Select relevant columns and rename
sv_df <- data.frame(
chrom1 = bionanotable[3],
pos1 = bionanotable[7],
chrom2 = bionanotable[4],
pos2 = bionanotable[8],
strand = bionanotable[24],
svtype = bionanotable$V10
) %>%
mutate(
strand1 = sapply(strsplit(as.character(V24), "/"), function(x) ifelse(length(x) > 1, x[1], NA)),
strand2 = sapply(strsplit(as.character(V24), "/"), function(x) ifelse(length(x) > 1, x[2], NA)),
strand1 = ifelse(is.na(strand1), "0", strand1),
strand2 = ifelse(is.na(strand2), "0", strand2)
) %>%
select(-V24) %>%
rename(
chrom1 = V3,
pos1 = V7,
chrom2 = V4,
pos2 = V8
)
sv_df <- sv_df %>%
mutate(
svtype = case_when(
svtype == "inversion" & strand1 == "+" & strand2 == "+" ~ "h2hINV",
svtype == "inversion" & strand1 == "-" & strand2 == "-" ~ "t2tINV",
TRUE ~ svtype
),
strand1 = case_when(
svtype == "DEL" ~ "+",
svtype == "DUP" ~ "-",
TRUE ~ strand1
),
strand2 = case_when(
svtype == "DEL" ~ "-",
svtype == "DUP" ~ "+",
TRUE ~ strand2
)
)
# Add sample column
sv_df$sample <- sample
sv_df <- sv_df %>% filter(svtype != "insertion")
sv_df$pos1 <- round(sv_df$pos1)
sv_df$pos2 <- round(sv_df$pos2)
sv_df <- sv_df %>% filter(svtype != "inversion")
sv_df <- sv_df %>% filter(svtype != "inversion_partial")
sv_df <- sv_df %>% select(chrom1, pos1, chrom2, pos2, strand1, strand2, svtype, sample)
# Create the sample directory and ensure Bionanodata directory exists
sample_dir <- file.path(result_dir, sample, "Bionanodata")
if (!dir.exists(sample_dir)) {
dir.create(sample_dir, recursive = TRUE)
}
# Export the data frame as CSV
output_file <- file.path(sample_dir, paste0("sv_df_", sample, ".csv"))
write.csv(sv_df, file = output_file, row.names = FALSE)
# Print confirmation message
cat("Export file:", output_file, "\n")
}
###############CREATEDFOFDIRECTORIES####################
for (i in patients) {
print(i)
wholedirectory <- file.path(bionanodirectory, i, "Bionanodata")
bionanofile <- list.files(wholedirectory)
cnvfile <- grep("*.smap", bionanofile, value = TRUE)
wholedirectory <- file.path(wholedirectory, cnvfile)
print(wholedirectory)
bionanofilesdirectories <- c(bionanofilesdirectories, wholedirectory)
}
##SV
##CREATEANDEXPORTALLTHESVDFS
lapply(bionanofilesdirectories, process_file_sv, bionanodirectory)
